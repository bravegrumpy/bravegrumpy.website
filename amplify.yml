version: 1
frontend: 
  phases:
    preBuild: 
      commands:
        - rm -rf node_modules
        - nvm install 20
        - nvm use  20
        - npm ci
    build:
      commands: 
        - npm run build
        - | 
          echo '{
            "version": 1,
            "directoryBehavior": "RETAIN",
            "routes": [
              {
              "route": "/*",
              "serveDirectory": "/"
              }
            ],
            "files": [
              {
                "source": "index.html",
                "headers": {
                  "cache-control": "no-cache"
                }
              },
              {
                "source": "**/*",
                "headers": {
                  "cache-control": "public, max-age=31536000, immutable"
                }
              }
            ]
          }' > dist/deploy-manifest.json
        - ls -la dist 
        - cat dist/deploy-manifest.json
  artifacts:
    baseDirectory: ./dist
    files:
      - '**/*'